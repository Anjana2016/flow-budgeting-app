<!DOCTYPE html>
<!-- saved from url=(0065)file:///Users/anjanasudhakar/Downloads/flow_budget_app_fixed.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üíö Flow Budgeting - Guilt-Free Zone</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Flow Budget">
    <meta name="theme-color" content="#10b981">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 100 100&#39;&gt;&lt;text y=&#39;.9em&#39; font-size=&#39;90&#39;&gt;%F0%9F%92%9A&lt;/text&gt;&lt;/svg&gt;">
    
    <!-- Tailwind CSS -->
    <script src="./index_files/tailwind.min.js"></script>
    
    <style>
        /* Custom CSS for animations and special effects */
        @keyframes subtleGradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes floatingPulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 16px 40px rgba(16, 185, 129, 0.4); 
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 20px 50px rgba(16, 185, 129, 0.6); 
            }
        }
        
        @keyframes slideInDown {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeInScale {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        @keyframes ringPulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        .animate-in {
            animation-fill-mode: both;
        }
        
        .slide-in-from-bottom-4 {
            animation: slideInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .slide-in-from-top-4 {
            animation: slideInDown 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .slide-in-from-left-4 {
            animation: slideInLeft 0.8s ease-out;
        }
        
        .slide-in-from-right-4 {
            animation: slideInRight 0.8s ease-out;
        }
        
        .fade-in-scale {
            animation: fadeInScale 0.8s ease-out;
        }
        
        /* Mobile optimization */
        @media screen and (max-width: 480px) {
            .container {
                padding: 16px;
            }
        }
        
        /* Touch optimization */
        button, input {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        /* Prevent zoom on input focus */
        input[type="number"] {
            font-size: 16px;
        }
        
        /* PWA safe areas */
        .container {
            padding-bottom: env(safe-area-inset-bottom);
            padding-top: env(safe-area-inset-top);
        }
        
        /* Custom gradient backgrounds */
        .bg-animated {
            background: linear-gradient(45deg, #0f0f1a, #1a1a2e, #16213e, #1a1a2e);
            background-size: 400% 400%;
            animation: subtleGradientShift 25s ease infinite;
        }
        
        .floating-add {
            animation: floatingPulse 3s ease-in-out infinite;
        }
        
        /* Dual progress ring system */
        .progress-ring-dual {
            position: relative;
        }
        
        .progress-ring-overlay {
            position: absolute;
            top: 0;
            left: 0;
            animation: ringPulse 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div id="root">
                <div class="min-h-screen bg-animated text-white relative overflow-hidden">
                    
                    <!-- Permission Toast -->
                    

                    <!-- Main Content Container -->
                    <div class="max-w-md mx-auto min-h-screen relative z-10">
                        <div class="pb-24 pt-6">
                            
                            
                            <div class="px-6 space-y-6 slide-in-from-bottom-4">
                                
                                <!-- Header -->
                                <div class="flex justify-between items-center mb-8 p-6 bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl slide-in-from-top-4">
                                    <div>
                                        <h1 class="text-lg font-semibold mb-1">Good afternoon, Sarah! ‚òÄÔ∏è</h1>
                                        <p class="text-sm text-slate-400">Perfect time for a guilt-free treat</p>
                                    </div>
                                    <button onclick="setActiveTab(&#39;setup&#39;)" class="text-slate-400 hover:text-white transition-colors p-2">‚öôÔ∏è</button>
                                </div>

                                <!-- Hero: Daily Guilt-Free Amount -->
                                
                <div class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-8 text-center relative overflow-hidden cursor-pointer fade-in-scale" style="box-shadow: 0 12px 32px rgba(16, 185, 129, 0.3);" onclick="handleHeroClick()">
                    
                    <!-- Shimmer effect -->
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-emerald-500/10 to-transparent animate-pulse opacity-60"></div>
                    
                    <div class="relative z-10">
                        <!-- Permission label -->
                        <div class="flex items-center justify-center gap-2 text-emerald-400 font-semibold text-sm mb-3 tracking-wide">
                            <span>‚úÖ</span>
                            <span>PRE-APPROVED TO SPEND</span>
                        </div>
                        
                        <!-- Daily amount with proper spacing -->
                        <div class="text-6xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent mb-2 hover:scale-105 transition-transform duration-300" style="letter-spacing: -1px;">
                            $105.00
                        </div>
                        
                        <!-- Overspent indicator -->
                        
                        
                        <!-- Encouragement text with reduced spacing -->
                        <p class="text-slate-300 font-medium mb-5">
                            Go ahead, you've earned it! This is YOUR money to enjoy guilt-free üéâ
                        </p>
                        
                        <!-- Progress Ring -->
                        
                <div class="w-32 h-32 mx-auto relative mb-4 progress-ring-dual">
                    <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 120 120">
                        <!-- Background circle -->
                        <circle cx="60" cy="60" r="50" stroke="rgba(255, 255, 255, 0.1)" stroke-width="8" fill="none"></circle>
                        
                        <!-- Green progress circle (base spending) -->
                        <circle cx="60" cy="60" r="50" stroke="url(#progressGradient)" stroke-width="8" fill="none" stroke-linecap="round" stroke-dasharray="314.1592653589793" stroke-dashoffset="314.1592653589793" class="transition-all duration-700">
                        </circle>
                        
                        <!-- Red overlay circle (overspending) -->
                        
                        
                        <defs>
                            <lineargradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#10b981"></stop>
                                <stop offset="100%" stop-color="#22c55e"></stop>
                            </lineargradient>
                            <lineargradient id="overspentGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#ef4444"></stop>
                                <stop offset="100%" stop-color="#f97316"></stop>
                            </lineargradient>
                        </defs>
                    </svg>
                    
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <div class="text-xs text-slate-400 mb-1">Enjoyed Today</div>
                        <div class="text-lg font-bold text-emerald-400">
                            $0.00
                        </div>
                    </div>
                </div>
            
                    </div>
                </div>
            

                                <!-- Quick Spending Actions -->
                                <div class="grid grid-cols-2 gap-4 slide-in-from-bottom-4">
                                    
                                    <button onclick="handleQuickSpend(5, &#39;Coffee ‚òï&#39;, &#39;coffee_generic&#39;)" class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6 text-center transition-all duration-300 hover:bg-white/12 hover:scale-105 hover:-translate-y-1 active:scale-95" style="box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);">
                                        <div class="text-3xl mb-3">‚òï</div>
                                        <div class="font-semibold text-white mb-1">Coffee ‚òï</div>
                                        <div class="text-xs text-slate-400">$5</div>
                                    </button>
                                    
                                    <button onclick="handleQuickSpend(15, &#39;Lunch üçï&#39;, &#39;lunch_generic&#39;)" class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6 text-center transition-all duration-300 hover:bg-white/12 hover:scale-105 hover:-translate-y-1 active:scale-95" style="box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);">
                                        <div class="text-3xl mb-3">üçï</div>
                                        <div class="font-semibold text-white mb-1">Lunch üçï</div>
                                        <div class="text-xs text-slate-400">$15</div>
                                    </button>
                                    
                                    <button onclick="handleQuickSpend(5, &#39;Snack üçø&#39;, &#39;snacks_generic&#39;)" class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6 text-center transition-all duration-300 hover:bg-white/12 hover:scale-105 hover:-translate-y-1 active:scale-95" style="box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);">
                                        <div class="text-3xl mb-3">üçø</div>
                                        <div class="font-semibold text-white mb-1">Snack üçø</div>
                                        <div class="text-xs text-slate-400">$5</div>
                                    </button>
                                    
                                    <button onclick="handleQuickSpend(0, &#39;Custom üí≥&#39;, &#39;custom&#39;)" class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6 text-center transition-all duration-300 hover:bg-white/12 hover:scale-105 hover:-translate-y-1 active:scale-95" style="box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);">
                                        <div class="text-3xl mb-3">üí≥</div>
                                        <div class="font-semibold text-white mb-1">Custom üí≥</div>
                                        <div class="text-xs text-slate-400">Custom</div>
                                    </button>
                                    
                                </div>

                                <!-- Custom Amount Entry -->
                                <div class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6">
                                    <h3 class="font-semibold mb-4 text-center">üí≥ Custom Guilt-Free Amount</h3>
                                    <div class="flex gap-3">
                                        <input type="number" placeholder="Enter amount" value="" onchange="updateCustomAmount(event.target.value)" class="flex-1 bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-400/50">
                                        <button onclick="handleCustomPurchase()" disabled="" class="bg-gradient-to-r from-emerald-500 to-cyan-500 disabled:from-gray-600 disabled:to-gray-600 rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 active:scale-95 disabled:cursor-not-allowed">
                                            Approve
                                        </button>
                                    </div>
                                </div>

                                <!-- Tomorrow Preview -->
                                
                <div class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6 slide-in-from-right-4">
                    <div class="tomorrow-title text-sm text-slate-400 mb-2">Tomorrow's Guilt-Free Amount</div>
                    <div class="text-3xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
                        $105.00
                    </div>
                    
                    
                    <div class="flex items-center gap-2 mt-3 text-sm text-emerald-400 font-medium">
                        <span>üéÅ</span>
                        <span>Plus any leftover from today!</span>
                    </div>
                    
                </div>
            

                                <!-- Spending Streak -->
                                <div class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6 slide-in-from-left-4">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-12 h-12 bg-gradient-to-r from-pink-500 to-rose-500 rounded-2xl flex items-center justify-center text-2xl animate-pulse">üî•</div>
                                        <div>
                                            <div class="font-bold text-lg">5-Day Guilt-Free Streak!</div>
                                            <div class="text-sm text-slate-400">You're absolutely crushing this budget thing ‚ú®</div>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-semibold bg-emerald-500 text-white">
                                            M
                                        </div>
                                        
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-semibold bg-emerald-500 text-white">
                                            T
                                        </div>
                                        
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-semibold bg-emerald-500 text-white">
                                            W
                                        </div>
                                        
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-semibold bg-emerald-500 text-white">
                                            T
                                        </div>
                                        
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-semibold bg-emerald-500 text-white">
                                            F
                                        </div>
                                        
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-semibold bg-cyan-500 text-white animate-pulse">
                                            S
                                        </div>
                                        
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-semibold bg-white/10 text-slate-400">
                                            S
                                        </div>
                                        
                                    </div>
                                </div>

                                <!-- Recent Guilt-Free Purchases -->
                                <div class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6 fade-in-scale">
                                    <div class="flex justify-between items-center mb-5">
                                        <h3 class="font-semibold flex items-center gap-2">
                                            <span>üíö</span>
                                            <span>Recent Guilt-Free Wins</span>
                                        </h3>
                                        <button class="text-sm text-purple-400 font-medium hover:text-purple-300 transition-colors">See all ‚Üí</button>
                                    </div>
                                    <div class="space-y-3">
                                        
                                        <div class="flex items-center gap-4 p-4 bg-emerald-500/5 border border-emerald-500/10 rounded-2xl cursor-pointer hover:bg-emerald-500/10 transition-all duration-300 hover:translate-x-1 relative">
                                            <div class="absolute top-2 right-3 text-xs opacity-70">‚úÖ</div>
                                            <div class="w-10 h-10 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-xl flex items-center justify-center text-lg">
                                                üçø
                                            </div>
                                            <div class="flex-1">
                                                <div class="font-medium text-sm">Morning Oat Latte</div>
                                                <div class="text-xs text-slate-400">Pre-approved ‚Ä¢ 6/20/2024 ‚Ä¢ Guilt-free ‚ú®</div>
                                            </div>
                                            <div class="font-bold text-emerald-400">6.50</div>
                                        </div>
                                        
                                        <div class="flex items-center gap-4 p-4 bg-emerald-500/5 border border-emerald-500/10 rounded-2xl cursor-pointer hover:bg-emerald-500/10 transition-all duration-300 hover:translate-x-1 relative">
                                            <div class="absolute top-2 right-3 text-xs opacity-70">‚úÖ</div>
                                            <div class="w-10 h-10 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-xl flex items-center justify-center text-lg">
                                                ü•ó
                                            </div>
                                            <div class="flex-1">
                                                <div class="font-medium text-sm">Healthy Lunch Bowl</div>
                                                <div class="text-xs text-slate-400">Pre-approved ‚Ä¢ 6/19/2024 ‚Ä¢ Guilt-free ‚ú®</div>
                                            </div>
                                            <div class="font-bold text-emerald-400">14.75</div>
                                        </div>
                                        
                                        <div class="flex items-center gap-4 p-4 bg-emerald-500/5 border border-emerald-500/10 rounded-2xl cursor-pointer hover:bg-emerald-500/10 transition-all duration-300 hover:translate-x-1 relative">
                                            <div class="absolute top-2 right-3 text-xs opacity-70">‚úÖ</div>
                                            <div class="w-10 h-10 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-xl flex items-center justify-center text-lg">
                                                üç¶
                                            </div>
                                            <div class="flex-1">
                                                <div class="font-medium text-sm">Friday Ice Cream</div>
                                                <div class="text-xs text-slate-400">Pre-approved ‚Ä¢ 6/19/2024 ‚Ä¢ Guilt-free ‚ú®</div>
                                            </div>
                                            <div class="font-bold text-emerald-400">4.25</div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                            

                            

                        </div>

                        <!-- Floating Add Button -->
                        <button onclick="handleFloatingAdd()" class="fixed bottom-32 right-6 w-16 h-16 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-3xl flex items-center justify-center text-2xl shadow-2xl transition-all duration-300 hover:scale-110 active:scale-95 floating-add">
                            ‚ûï
                        </button>

                        <!-- Bottom Navigation -->
                        <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 w-full max-w-md px-6">
                            <div class="bg-white/10 backdrop-blur-2xl border border-white/20 rounded-3xl p-3">
                                <div class="flex justify-around items-center">
                                    <button onclick="setActiveTab(&#39;guilt-free&#39;)" class="flex flex-col items-center gap-1 p-3 rounded-2xl transition-all duration-300 bg-emerald-500/30 text-emerald-300">
                                        <span class="text-lg">üíö</span>
                                        <span class="text-xs font-semibold">Guilt-Free</span>
                                    </button>
                                    <button onclick="setActiveTab(&#39;setup&#39;)" class="flex flex-col items-center gap-1 p-3 rounded-2xl transition-all duration-300 text-slate-400 hover:text-white">
                                        <span class="text-lg">‚öôÔ∏è</span>
                                        <span class="text-xs font-semibold">Setup</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

    <script>
        // App State Management
        let appState = {
            user: {
                id: 'user_1',
                name: 'Sarah',
                monthlyIncome: 3200,
                currentPeriod: 'monthly',
                joinDate: new Date('2024-06-01')
            },
            currentMonth: {
                year: 2024,
                month: 6,
                startDate: new Date('2024-06-01'),
                endDate: new Date('2024-06-30'),
                daysTotal: 30,
                daysRemaining: 10
            },
            budget: {
                fixedExpenses: [
                    { id: 1, name: 'Rent', amount: 1200, dueDate: 1, category: 'housing' },
                    { id: 2, name: 'Insurance', amount: 150, dueDate: 15, category: 'insurance' },
                    { id: 3, name: 'Phone', amount: 80, dueDate: 10, category: 'utilities' }
                ],
                allocation: {
                    spend: 0.6,
                    stash: 0.25,
                    save: 0.15
                }
            },
            transactions: [
                { id: 1, amount: 6.50, description: 'Morning Oat Latte', category: 'spend', timestamp: new Date('2024-06-20T08:30:00'), merchantId: 'coffee_shop', guiltFree: true },
                { id: 2, amount: 14.75, description: 'Healthy Lunch Bowl', category: 'spend', timestamp: new Date('2024-06-19T12:15:00'), merchantId: 'lunch_spot', guiltFree: true },
                { id: 3, amount: 4.25, description: 'Friday Ice Cream', category: 'spend', timestamp: new Date('2024-06-19T18:00:00'), merchantId: 'ice_cream', guiltFree: true },
                { id: 4, amount: 8.75, description: 'Afternoon Snack', category: 'spend', timestamp: new Date('2024-06-18T15:30:00'), merchantId: 'snack_bar', guiltFree: true }
            ],
            gamification: {
                currentStreak: 5,
                totalGuiltFreeExpenses: 47,
                achievements: ['5_day_streak', 'guilt_free_week', 'budget_champion'],
                lastCelebration: new Date('2024-06-20T12:15:00')
            },
            ui: {
                activeTab: 'guilt-free',
                showToast: false,
                toastMessage: '',
                customAmount: ''
            }
        };

        // Calculate Daily Guilt-Free Amount with proper $5 rounding
        function calculateGuiltFreeFlow(state) {
            const { user, budget, transactions, currentMonth } = state;
            
            const totalFixedExpenses = budget.fixedExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const availableIncome = user.monthlyIncome - totalFixedExpenses;
            const spendAllocation = availableIncome * budget.allocation.spend;
            const totalSpent = transactions.reduce((sum, tx) => sum + tx.amount, 0);
            const remainingSpendBudget = spendAllocation - totalSpent;
            const rawDailyAmount = remainingSpendBudget / currentMonth.daysRemaining;
            
            // Round to nearest $5 increment
            const dailyGuiltFreeAmount = Math.round(rawDailyAmount / 5) * 5;
            
            const today = new Date().toDateString();
            const todaySpent = transactions
                .filter(tx => tx.timestamp.toDateString() === today)
                .reduce((sum, tx) => sum + tx.amount, 0);
            
            const todayRemaining = Math.max(0, dailyGuiltFreeAmount - todaySpent);
            const spentPercentage = todaySpent / dailyGuiltFreeAmount;
            const overspentAmount = Math.max(0, todaySpent - dailyGuiltFreeAmount);
            
            // Determine spending state for contextual messaging
            let spendingState = 'under';
            if (spentPercentage >= 0.95 && spentPercentage <= 1.05) {
                spendingState = 'perfect';
            } else if (spentPercentage > 1.05) {
                spendingState = 'over';
            }
            
            // Tomorrow calculation with overspending impact
            const baseTomorrowAmount = Math.round(rawDailyAmount / 5) * 5;
            const tomorrowAdjustment = overspentAmount > 0 ? Math.round(overspentAmount / 5) * 5 : 0;
            const tomorrowAmount = Math.max(0, baseTomorrowAmount - tomorrowAdjustment);
            
            return {
                dailyGuiltFreeAmount: Math.max(0, dailyGuiltFreeAmount),
                todayRemaining,
                todaySpent,
                spentPercentage: Math.min(spentPercentage, 2), // Cap at 200% for visual
                overspentAmount,
                spendingState,
                remainingSpendBudget,
                totalSpent,
                spendAllocation,
                stashAmount: availableIncome * budget.allocation.stash,
                saveAmount: availableIncome * budget.allocation.save,
                progressPercentage: ((currentMonth.daysTotal - currentMonth.daysRemaining) / currentMonth.daysTotal) * 100,
                tomorrowAmount,
                tomorrowAdjustment
            };
        }

        // Quick suggestions for guilt-free spending
        const guiltFreeSuggestions = [
            { amount: 5, label: 'Coffee ‚òï', description: '$5', icon: '‚òï', merchantId: 'coffee_generic' },
            { amount: 15, label: 'Lunch üçï', description: '$15', icon: 'üçï', merchantId: 'lunch_generic' },
            { amount: 5, label: 'Snack üçø', description: '$5', icon: 'üçø', merchantId: 'snacks_generic' },
            { amount: 0, label: 'Custom üí≥', description: 'Custom', icon: 'üí≥', merchantId: 'custom' }
        ];

        // Contextual guilt-free messages based on spending state
        const guiltFreeMessages = {
            under: [
                "üéâ Guilt-free purchase confirmed! You're doing amazing!",
                "‚ú® Perfect choice! This is exactly what your budget is for!",
                "üíö Approved! You've earned this guilt-free spending!"
            ],
            perfect: [
                "üéØ Amazing control! Almost perfect spending today!",
                "‚≠ê You're hitting your target perfectly!",
                "üî• Incredible precision! You know your budget!"
            ],
            over: [
                "üíõ Using tomorrow's money - totally fine!",
                "ü§ó No worries! We'll adjust tomorrow's amount",
                "‚úÖ Still approved! Tomorrow gets a small adjustment"
            ]
        };

        // Show permission toast with contextual messaging
        function showPermissionToast(flowData) {
            const messages = guiltFreeMessages[flowData.spendingState];
            const message = messages[Math.floor(Math.random() * messages.length)];
            
            appState.ui.toastMessage = message;
            appState.ui.showToast = true;
            
            setTimeout(() => {
                appState.ui.showToast = false;
                renderApp();
            }, 3000);
            
            renderApp();
        }

        // Handle guilt-free purchase with $5 rounding
        function handleGuiltFreePurchase(amount, description, merchantId) {
            // Round to nearest $5
            const roundedAmount = Math.round(amount / 5) * 5;
            
            const newTransaction = {
                id: Date.now(),
                amount: roundedAmount,
                description: description,
                category: 'spend',
                timestamp: new Date(),
                merchantId: merchantId || null,
                guiltFree: true
            };
            
            appState.transactions.unshift(newTransaction);
            appState.gamification.totalGuiltFreeExpenses += 1;
            
            // Random streak increase
            if (Math.random() > 0.8) {
                appState.gamification.currentStreak += 1;
            }
            
            appState.ui.customAmount = '';
            
            setTimeout(() => {
                const flowData = calculateGuiltFreeFlow(appState);
                showPermissionToast(flowData);
            }, 500);
            
            renderApp();
        }

        // Handle custom purchase
        function handleCustomPurchase() {
            const amount = parseFloat(appState.ui.customAmount);
            if (amount > 0) {
                handleGuiltFreePurchase(amount, 'Custom Purchase', 'custom');
            }
        }

        // Simulate haptic feedback
        function triggerHaptic(intensity = 'medium') {
            if (navigator.vibrate) {
                const patterns = { light: [10], medium: [20], strong: [50] };
                navigator.vibrate(patterns[intensity] || patterns.medium);
            }
        }

        // Get time-based greeting
        function getGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) return 'Good morning, Sarah! ‚òÄÔ∏è';
            if (hour < 17) return 'Good afternoon, Sarah! ‚òÄÔ∏è';
            return 'Good evening, Sarah! üåô';
        }

        function getTimeContext() {
            const hour = new Date().getHours();
            if (hour < 12) return 'Perfect time for a guilt-free coffee';
            if (hour < 17) return 'Perfect time for a guilt-free treat';
            return 'Perfect time to enjoy your money';
        }

        // Create dual progress ring system
        function createProgressRing(flowData) {
            const baseProgress = Math.min(flowData.spentPercentage, 1) * 100;
            const overProgress = Math.max(0, flowData.spentPercentage - 1) * 100;
            
            return `
                <div class="w-32 h-32 mx-auto relative mb-4 progress-ring-dual">
                    <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 120 120">
                        <!-- Background circle -->
                        <circle cx="60" cy="60" r="50" stroke="rgba(255, 255, 255, 0.1)" stroke-width="8" fill="none"></circle>
                        
                        <!-- Green progress circle (base spending) -->
                        <circle cx="60" cy="60" r="50" 
                                stroke="url(#progressGradient)" 
                                stroke-width="8" 
                                fill="none" 
                                stroke-linecap="round" 
                                stroke-dasharray="${2 * Math.PI * 50}" 
                                stroke-dashoffset="${2 * Math.PI * 50 * (1 - Math.min(flowData.spentPercentage, 1))}" 
                                class="transition-all duration-700">
                        </circle>
                        
                        <!-- Red overlay circle (overspending) -->
                        ${flowData.spentPercentage > 1 ? `
                        <circle cx="60" cy="60" r="50" 
                                stroke="url(#overspentGradient)" 
                                stroke-width="6" 
                                fill="none" 
                                stroke-linecap="round" 
                                stroke-dasharray="${2 * Math.PI * 50}" 
                                stroke-dashoffset="${2 * Math.PI * 50 * (1 - Math.min(flowData.spentPercentage - 1, 1))}" 
                                class="transition-all duration-700 progress-ring-overlay">
                        </circle>
                        ` : ''}
                        
                        <defs>
                            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#10b981"></stop>
                                <stop offset="100%" stop-color="#22c55e"></stop>
                            </linearGradient>
                            <linearGradient id="overspentGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#ef4444"></stop>
                                <stop offset="100%" stop-color="#f97316"></stop>
                            </linearGradient>
                        </defs>
                    </svg>
                    
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <div class="text-xs text-slate-400 mb-1">Enjoyed Today</div>
                        <div class="text-lg font-bold ${flowData.overspentAmount > 0 ? 'text-orange-400' : 'text-emerald-400'}">
                            $${flowData.todaySpent.toFixed(2)}
                        </div>
                    </div>
                </div>
            `;
        }

        // Create hero section with proper spacing and overspent indicator
        function createHeroSection(flowData) {
            return `
                <div class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-8 text-center relative overflow-hidden cursor-pointer fade-in-scale"
                     style="box-shadow: 0 12px 32px rgba(16, 185, 129, 0.3);"
                     onclick="handleHeroClick()">
                    
                    <!-- Shimmer effect -->
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-emerald-500/10 to-transparent animate-pulse opacity-60"></div>
                    
                    <div class="relative z-10">
                        <!-- Permission label -->
                        <div class="flex items-center justify-center gap-2 text-emerald-400 font-semibold text-sm mb-3 tracking-wide">
                            <span>‚úÖ</span>
                            <span>PRE-APPROVED TO SPEND</span>
                        </div>
                        
                        <!-- Daily amount with proper spacing -->
                        <div class="text-6xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent mb-2 hover:scale-105 transition-transform duration-300"
                             style="letter-spacing: -1px;">
                            $${flowData.todayRemaining.toFixed(2)}
                        </div>
                        
                        <!-- Overspent indicator -->
                        ${flowData.overspentAmount > 0 ? `
                        <div class="text-sm font-medium text-orange-400 mb-3">
                            $${flowData.overspentAmount.toFixed(2)} over today's budget
                        </div>
                        ` : ''}
                        
                        <!-- Encouragement text with reduced spacing -->
                        <p class="text-slate-300 font-medium mb-5">
                            Go ahead, you've earned it! This is YOUR money to enjoy guilt-free üéâ
                        </p>
                        
                        <!-- Progress Ring -->
                        ${createProgressRing(flowData)}
                    </div>
                </div>
            `;
        }

        // Create tomorrow section with overspending impact
        function createTomorrowSection(flowData) {
            return `
                <div class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6 slide-in-from-right-4">
                    <div class="tomorrow-title text-sm text-slate-400 mb-2">Tomorrow's Guilt-Free Amount</div>
                    <div class="text-3xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
                        $${flowData.tomorrowAmount.toFixed(2)}
                    </div>
                    
                    ${flowData.tomorrowAdjustment > 0 ? `
                    <div class="flex items-center gap-2 mt-3 text-sm text-orange-400 font-medium">
                        <span>‚ö†Ô∏è</span>
                        <span>$${flowData.tomorrowAdjustment.toFixed(2)} less due to today's overspending</span>
                    </div>
                    ` : flowData.todayRemaining > 0 ? `
                    <div class="flex items-center gap-2 mt-3 text-sm text-emerald-400 font-medium">
                        <span>üéÅ</span>
                        <span>Plus any leftover from today!</span>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // Handle hero click
        function handleHeroClick() {
            triggerHaptic('strong');
            const flowData = calculateGuiltFreeFlow(appState);
            showPermissionToast(flowData);
        }

        // Render main app
        function renderApp() {
            const flowData = calculateGuiltFreeFlow(appState);
            
            const app = `
                <div class="min-h-screen bg-animated text-white relative overflow-hidden">
                    
                    <!-- Permission Toast -->
                    ${appState.ui.showToast ? `
                    <div class="fixed top-6 left-1/2 transform -translate-x-1/2 z-50 slide-in-from-top-4">
                        <div class="bg-gradient-to-r from-emerald-500 to-cyan-500 text-white px-6 py-4 rounded-2xl font-semibold shadow-2xl">
                            ${appState.ui.toastMessage}
                        </div>
                    </div>
                    ` : ''}

                    <!-- Main Content Container -->
                    <div class="max-w-md mx-auto min-h-screen relative z-10">
                        <div class="pb-24 pt-6">
                            
                            ${appState.ui.activeTab === 'guilt-free' ? `
                            <div class="px-6 space-y-6 slide-in-from-bottom-4">
                                
                                <!-- Header -->
                                <div class="flex justify-between items-center mb-8 p-6 bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl slide-in-from-top-4">
                                    <div>
                                        <h1 class="text-lg font-semibold mb-1">${getGreeting()}</h1>
                                        <p class="text-sm text-slate-400">${getTimeContext()}</p>
                                    </div>
                                    <button onclick="setActiveTab('setup')" class="text-slate-400 hover:text-white transition-colors p-2">‚öôÔ∏è</button>
                                </div>

                                <!-- Hero: Daily Guilt-Free Amount -->
                                ${createHeroSection(flowData)}

                                <!-- Quick Spending Actions -->
                                <div class="grid grid-cols-2 gap-4 slide-in-from-bottom-4">
                                    ${guiltFreeSuggestions.map((suggestion, idx) => `
                                    <button onclick="handleQuickSpend(${suggestion.amount}, '${suggestion.label}', '${suggestion.merchantId}')" 
                                            class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6 text-center transition-all duration-300 hover:bg-white/12 hover:scale-105 hover:-translate-y-1 active:scale-95"
                                            style="box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);">
                                        <div class="text-3xl mb-3">${suggestion.icon}</div>
                                        <div class="font-semibold text-white mb-1">${suggestion.label}</div>
                                        <div class="text-xs text-slate-400">${suggestion.description}</div>
                                    </button>
                                    `).join('')}
                                </div>

                                <!-- Custom Amount Entry -->
                                <div class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6">
                                    <h3 class="font-semibold mb-4 text-center">üí≥ Custom Guilt-Free Amount</h3>
                                    <div class="flex gap-3">
                                        <input type="number" 
                                               placeholder="Enter amount" 
                                               value="${appState.ui.customAmount}"
                                               onchange="updateCustomAmount(event.target.value)"
                                               class="flex-1 bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-400/50">
                                        <button onclick="handleCustomPurchase()" 
                                                ${!appState.ui.customAmount || parseFloat(appState.ui.customAmount) <= 0 ? 'disabled' : ''}
                                                class="bg-gradient-to-r from-emerald-500 to-cyan-500 disabled:from-gray-600 disabled:to-gray-600 rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 active:scale-95 disabled:cursor-not-allowed">
                                            Approve
                                        </button>
                                    </div>
                                </div>

                                <!-- Tomorrow Preview -->
                                ${createTomorrowSection(flowData)}

                                <!-- Spending Streak -->
                                <div class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6 slide-in-from-left-4">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-12 h-12 bg-gradient-to-r from-pink-500 to-rose-500 rounded-2xl flex items-center justify-center text-2xl animate-pulse">üî•</div>
                                        <div>
                                            <div class="font-bold text-lg">${appState.gamification.currentStreak}-Day Guilt-Free Streak!</div>
                                            <div class="text-sm text-slate-400">You're absolutely crushing this budget thing ‚ú®</div>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        ${['M', 'T', 'W', 'T', 'F', 'S', 'S'].map((day, idx) => `
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-semibold ${
                                            idx < appState.gamification.currentStreak 
                                                ? 'bg-emerald-500 text-white' 
                                                : idx === appState.gamification.currentStreak 
                                                    ? 'bg-cyan-500 text-white animate-pulse' 
                                                    : 'bg-white/10 text-slate-400'
                                        }">
                                            ${day}
                                        </div>
                                        `).join('')}
                                    </div>
                                </div>

                                <!-- Recent Guilt-Free Purchases -->
                                <div class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6 fade-in-scale">
                                    <div class="flex justify-between items-center mb-5">
                                        <h3 class="font-semibold flex items-center gap-2">
                                            <span>üíö</span>
                                            <span>Recent Guilt-Free Wins</span>
                                        </h3>
                                        <button class="text-sm text-purple-400 font-medium hover:text-purple-300 transition-colors">See all ‚Üí</button>
                                    </div>
                                    <div class="space-y-3">
                                        ${appState.transactions.slice(0, 3).map(tx => `
                                        <div class="flex items-center gap-4 p-4 bg-emerald-500/5 border border-emerald-500/10 rounded-2xl cursor-pointer hover:bg-emerald-500/10 transition-all duration-300 hover:translate-x-1 relative">
                                            <div class="absolute top-2 right-3 text-xs opacity-70">‚úÖ</div>
                                            <div class="w-10 h-10 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-xl flex items-center justify-center text-lg">
                                                ${tx.description.includes('Coffee') ? '‚òï' : 
                                                  tx.description.includes('Lunch') ? 'ü•ó' : 
                                                  tx.description.includes('Ice Cream') ? 'üç¶' : 'üçø'}
                                            </div>
                                            <div class="flex-1">
                                                <div class="font-medium text-sm">${tx.description}</div>
                                                <div class="text-xs text-slate-400">Pre-approved ‚Ä¢ ${tx.timestamp.toLocaleDateString()} ‚Ä¢ Guilt-free ‚ú®</div>
                                            </div>
                                            <div class="font-bold text-emerald-400">${tx.amount.toFixed(2)}</div>
                                        </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                            ` : ''}

                            ${appState.ui.activeTab === 'setup' ? `
                            <div class="px-6 space-y-6 slide-in-from-bottom-4">
                                <h1 class="text-2xl font-bold text-center mb-8">Setup Your Flow</h1>
                                <div class="bg-white/8 backdrop-blur-sm border border-white/12 rounded-3xl p-6">
                                    <h3 class="font-semibold mb-4">CURRENT SETTINGS</h3>
                                    <div class="space-y-3 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-slate-400">Monthly Income:</span>
                                            <span class="font-semibold">${appState.user.monthlyIncome.toLocaleString()}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-slate-400">Fixed Bills:</span>
                                            <span class="font-semibold">${appState.budget.fixedExpenses.reduce((sum, exp) => sum + exp.amount, 0).toLocaleString()}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            ` : ''}

                        </div>

                        <!-- Floating Add Button -->
                        <button onclick="handleFloatingAdd()" 
                                class="fixed bottom-32 right-6 w-16 h-16 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-3xl flex items-center justify-center text-2xl shadow-2xl transition-all duration-300 hover:scale-110 active:scale-95 floating-add">
                            ‚ûï
                        </button>

                        <!-- Bottom Navigation -->
                        <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 w-full max-w-md px-6">
                            <div class="bg-white/10 backdrop-blur-2xl border border-white/20 rounded-3xl p-3">
                                <div class="flex justify-around items-center">
                                    <button onclick="setActiveTab('guilt-free')" 
                                            class="flex flex-col items-center gap-1 p-3 rounded-2xl transition-all duration-300 ${appState.ui.activeTab === 'guilt-free' ? 'bg-emerald-500/30 text-emerald-300' : 'text-slate-400 hover:text-white'}">
                                        <span class="text-lg">üíö</span>
                                        <span class="text-xs font-semibold">Guilt-Free</span>
                                    </button>
                                    <button onclick="setActiveTab('setup')" 
                                            class="flex flex-col items-center gap-1 p-3 rounded-2xl transition-all duration-300 ${appState.ui.activeTab === 'setup' ? 'bg-purple-500/30 text-purple-300' : 'text-slate-400 hover:text-white'}">
                                        <span class="text-lg">‚öôÔ∏è</span>
                                        <span class="text-xs font-semibold">Setup</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('root').innerHTML = app;
        }

        // Global functions for event handling
        function setActiveTab(tab) {
            appState.ui.activeTab = tab;
            triggerHaptic('light');
            renderApp();
        }

        function handleQuickSpend(amount, description, merchantId) {
            triggerHaptic('medium');
            if (merchantId === 'custom') {
                appState.ui.customAmount = '';
                renderApp();
            } else {
                handleGuiltFreePurchase(amount, description, merchantId);
            }
        }

        function updateCustomAmount(value) {
            appState.ui.customAmount = value;
            renderApp();
        }

        function handleFloatingAdd() {
            triggerHaptic('strong');
            const flowData = calculateGuiltFreeFlow(appState);
            appState.ui.toastMessage = "üí≥ Ready to add a guilt-free purchase!";
            appState.ui.showToast = true;
            setTimeout(() => {
                appState.ui.showToast = false;
                renderApp();
            }, 3000);
            renderApp();
        }

        // Initialize app
        renderApp();
    </script>

</body></html>